[{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Vincent Arel-Bundock. Author, maintainer, copyright holder.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Arel-Bundock V (2023). tinysnapshot: Snapshots Unit Tests using 'tinytest' Framework. R package version 0.0.2.9000, https://vincentarelbundock.github.io/tinysnapshot.","code":"@Manual{,   title = {tinysnapshot: Snapshots for Unit Tests using the 'tinytest' Framework},   author = {Vincent Arel-Bundock},   year = {2023},   note = {R package version 0.0.2.9000},   url = {https://vincentarelbundock.github.io/tinysnapshot}, }"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"tinysnapshot-snapshots-for-unit-tests-in-r-using-the-tinytest-framework","dir":"","previous_headings":"","what":"Snapshots for Unit Tests using the tinytest Framework","title":"Snapshots for Unit Tests using the tinytest Framework","text":"tinytest “lightweight, -dependency, full-featured package unit testing R” created Mark van der Loo. tinysnapshot extends tinytest expectations test plots (base R ggplot2) print() output. particular, tinysnapshot allows: Taking snapshots known “target” plots print() output. Testing “current” plot print() output matches target. Displaying visual “diff” facilitate comparison test fails. hood, tinysnapshot uses magick package Jeroen Ooms read compare images, diffobjpackage Brodie Gaslam compare printed output.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Snapshots for Unit Tests using the tinytest Framework","text":"Install development version tinysnapshot: may also want install additional packages benefit extra features:","code":"install.packages(\"tinysnapshot\") remotes::install_github(\"vincentarelbundock/tinysnapshot\") install.packages(c(\"rsvg\", \"ragg\", \"svglite\"))"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"visual-expectations-expect_snapshot_plot","dir":"","previous_headings":"","what":"Visual expectations: expect_snapshot_plot()","title":"Snapshots for Unit Tests using the tinytest Framework","text":"test visual expectation, create R script, give name starts “test”, save inst/tinytest/ directory package. test script visual expectations must include two lines top: users run tinytest suite, expect_snapshot_plot() expect_snapshot_print() expectations executed three main states can arise: Test fails saves visual snapshot inst/tinytest/_tinysnapshot directory. Test passes plot matches snapshot file. Test fails saves comparison files inst/tinytest/_tinysnapshot_review","code":"library(\"tinytest\") using(\"tinysnapshot\")"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"ggplot2","dir":"","previous_headings":"Visual expectations: expect_snapshot_plot()","what":"ggplot2","title":"Snapshots for Unit Tests using the tinytest Framework","text":"example script, test two ggplot2 objects:","code":"library(\"ggplot2\") library(\"tinytest\") using(\"tinysnapshot\")  p1 <- ggplot(mtcars, aes(mpg, wt)) + geom_point() p2 <- ggplot(mtcars, aes(mpg, hp)) + geom_point()  # On first run: fail and save a snapshot # On subsequent runs: pass expect_snapshot_plot(p1, label = \"ggplot2_example\")  # Always fails expect_snapshot_plot(p2, label = \"ggplot2_example\")"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"base-r-graphics","dir":"","previous_headings":"Visual expectations: expect_snapshot_plot()","what":"Base R graphics","title":"Snapshots for Unit Tests using the tinytest Framework","text":"Testing Base R plot slightly different: need supply function prints plot:","code":"library(\"tinytest\") using(\"tinysnapshot\")  p1 <- function() plot(mtcars$hp, mtcars$wt) p2 <- function() plot(mtcars$hp, mtcars$mpg)  # On first run: fail and save a snapshot # On subsequent runs: pass expect_snapshot_plot(p1, label = \"base_example\")  # Always fails expect_snapshot_plot(p2, label = \"base_example\")"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"options-and-arguments","dir":"","previous_headings":"Visual expectations: expect_snapshot_plot()","what":"Options and arguments","title":"Snapshots for Unit Tests using the tinytest Framework","text":"expect_snapshot_plot supports 4 graphics devices: png ragg PNG, svg svglite SVG. can set different values height width pictures (pixels PNG inches SVG). arguments can also fixed globally using options:","code":"options(tinysnapshot_device = \"svglite\") options(tinysnapshot_height = 7) # inches options(tinysnapshot_width = 7) options(tinysnapshot_tol = 200) # pixels"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"visual-diff","dir":"","previous_headings":"Visual expectations: expect_snapshot_plot()","what":"Visual diff","title":"Snapshots for Unit Tests using the tinytest Framework","text":"(“”) tests fail, tinysnapshot save diff files inst/tinytest/_tinysnapshot_review/ folder. Diff files plots look like :","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"print-expectations-expect_snapshot_print","dir":"","previous_headings":"","what":"Print expectations: expect_snapshot_print()","title":"Snapshots for Unit Tests using the tinytest Framework","text":"First, save script inst/tinytest/test-print.R: , run tests. first time run test, fails saves reference file. second time run , already reference text file, one tests fails. expected result.","code":"library(\"tinytest\") using(\"tinysnapshot\")  mod1 <- lm(mpg ~ hp + factor(gear), mtcars) expect_snapshot_print(summary(mod1), label = \"print-lm_summary\")  mod2 <- lm(mpg ~ factor(gear), mtcars) expect_snapshot_print(summary(mod2), label = \"print-lm_summary\") tinytest::run_test_file(\"inst/tinytest/test-print.R\")"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"print-diff","dir":"","previous_headings":"Print expectations: expect_snapshot_print()","what":"Print diff","title":"Snapshots for Unit Tests using the tinytest Framework","text":"tests fail, tinytest return diff like one: many failures, tinytest always print full diff. cases, can save tinytest object print manually specifying nlong argument:","code":"test-print.R..................    2 tests 2 fails 0.3s     ----- FAILED[]: test-print.R<12--12>     call| expect_snapshot_print(summary(mod1), label = \"print-lm_summary\")     diff| Missing reference file.     info| diffobj::printDiff()     ----- FAILED[]: test-print.R<15--15>     call| expect_snapshot_print(summary(mod2), label = \"print-lm_summary\")     diff| < ref                                                                diff| > x                                                                  diff| @@ 1,21 / 1,20 @@                                                    diff|      diff| Call:                                                              diff| < lm(formula = mpg ~ hp + factor(gear), data = mtcars)               diff| > lm(formula = mpg ~ factor(gear), data = mtcars)                    diff|      diff| Residuals:                                                         diff| Min      1Q  Median      3Q     Max                            diff| < -4.4937 -2.3586 -0.8277  2.2753  7.7287                            diff| > -6.7333 -3.2333 -0.9067  2.8483  9.3667                            diff|      diff| Coefficients:                                                      diff| Estimate Std. Error t value Pr(>|t|)                 diff| < (Intercept)   27.88193    2.10908  13.220 1.47e-13 ***             diff| < hp            -0.06685    0.01105  -6.052 1.59e-06 ***             diff| > (Intercept)     16.107      1.216  13.250 7.87e-14 ***             diff| < factor(gear)4  2.63486    1.55164   1.698 0.100575                 diff| > factor(gear)4    8.427      1.823   4.621 7.26e-05 ***             diff| < factor(gear)5  6.57476    1.64268   4.002 0.000417 ***             diff| > factor(gear)5    5.273      2.431   2.169   0.0384 *               diff| ---                                                                diff| Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1     diff|      diff| < Residual standard error: 3.154 on 28 degrees of freedom            diff| > Residual standard error: 4.708 on 29 degrees of freedom            diff| < Multiple R-squared:  0.7527,    Adjusted R-squared:  0.7262        diff| > Multiple R-squared:  0.4292,    Adjusted R-squared:  0.3898        diff| < F-statistic: 28.41 on 3 and 28 DF,  p-value: 1.217e-08             diff| > F-statistic:  10.9 on 2 and 29 DF,  p-value: 0.0002948             diff|      info| diffobj::printDiff()          Warning message:     Creating reference file: _tinysnapshot/print-lm_summary.txt results <- tinytest::run_test_dir() print(results, nlong = Inf)"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"updating-snapshots","dir":"","previous_headings":"","what":"Updating snapshots","title":"Snapshots for Unit Tests using the tinytest Framework","text":"update snapshot test, simply delete relevant snapshot inst/tinytest/_tinysnapshot folder run test suite . ran suite first time, report failure generate new snapshot.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"cran-continuous-integration-and-deterministic-plots","dir":"","previous_headings":"","what":"CRAN, continuous integration, and deterministic plots","title":"Snapshots for Unit Tests using the tinytest Framework","text":"general, images produced R deterministic, meaning can vary slightly based operating system, graphics device, R version, etc. Unfortunately, means visual expectations often fail CRAN, tests run many different platforms. packages like vdiffr ship embedded version svglite fonts ensure deterministic plots. tinysnapshot (yet). steps can take make testing images less painful continuous integration: Use options(tinysnapshot_os = \"Darwin\") (“Windows”, “Linux”, etc.) indicate operating system snapshots created, skip visual snapshots operating systems. Available tinysnapshot 0.0.3 development version Github. Run continuous integration tests using R version operating system one used generate snapshots. Use svglite graphics device default: options(tinysnapshot_device = \"svglite\") Skip visual tests CRAN.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/index.html","id":"minimal-package-example","dir":"","previous_headings":"","what":"Minimal package example","title":"Snapshots for Unit Tests using the tinytest Framework","text":"now create minimal R package illustrate use tinysnapshot “real world.” Create temp directory use pkgKitten package create ultra-minimalist package (alternative usethis package): Download example test script tinysnapshot repository: package now includes 7 tests: 1 created default puppy() function, 6 tests test-png.R script. run tinytest first time, 6 test-png.R tests fail, generate snapshots PNG format: second time run test suite, 3 test-png.R tests fail:","code":"library(tinytest) library(pkgKitten) kitten(name = \"testpkg\") Creating directories ...     Creating DESCRIPTION ...     Creating NAMESPACE ...     Adding pkgKitten overrides.     >> added .gitignore file     >> added .Rbuildignore file     >> added tinytest support      Consider reading the documentation for all the packaging details.     A good start is the 'Writing R Extensions' manual.      And run 'R CMD check'. Run it frequently. And think of those kittens. download.file(     url = \"https://raw.githubusercontent.com/vincentarelbundock/tinysnapshot/main/inst/tinytest/test-png.R\",     destfile = \"testpkg/inst/tinytest/test-png.R\",     quiet = TRUE) setwd(\"testpkg\") tinytest::run_test_dir(\"inst/tinytest\") test_testpkg.R................    1 tests OK 22ms     test-png.R..................    6 tests 6 fails 0.8s     ----- FAILED[]: test-png.R<15--15>     call| expect_snapshot_plot(p1, \"base\")     diff| 0     info| pixels     ----- FAILED[]: test-png.R<18--18>     call| **expect_snapshot_plot**(p2, \"base\")     diff| 3232     info| pixels     ----- FAILED[]: test-png.R<25--25>     call| expect_snapshot_plot(p1, \"ggplot2_variable\")     diff| 0     info| pixels     FAILED[]: test-png.R<28--28> expect_snapshot_plot(p2, \"ggplot2_variable\")     FAILED[]: test-png.R<31--31> expect_snapshot_plot(p3, \"ggplot2_theme\")     FAILED[]: test-png.R<34--34> expect_snapshot_plot(p4, \"ggplot2_theme\")          Showing 6 out of 7 results: 6 fails, 1 passes (0.8s)     Warning messages:     1: Creating reference file: _tinysnapshot/base.png      2: Creating reference file: _tinysnapshot/ggplot2_variable.png      3: Creating reference file: _tinysnapshot/ggplot2_theme.png tinytest::run_test_dir(\"inst/tinytest\") test_testpkg.R................    1 tests OK 6ms     test-png.R....................    6 tests 3 fails 0.6s     ----- FAILED[]: test-png.R<18--18>     call| expect_snapshot_plot(p2, \"base\")     diff| 3232     info| pixels     ----- FAILED[]: test-png.R<28--28>     call| expect_snapshot_plot(p2, \"ggplot2_variable\")     diff| 33536     info| pixels     ----- FAILED[]: test-png.R<34--34>     call| expect_snapshot_plot(p4, \"ggplot2_theme\")     diff| 191955     info| pixels          Showing 3 out of 7 results: 3 fails, 4 passes (0.7s)"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_equivalent_images.html","id":null,"dir":"Reference","previous_headings":"","what":"Test if two image files are equivalent — expect_equivalent_images","title":"Test if two image files are equivalent — expect_equivalent_images","text":"Test two image files equivalent","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_equivalent_images.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test if two image files are equivalent — expect_equivalent_images","text":"","code":"expect_equivalent_images(   current,   target,   tol = getOption(\"tinysnapshot_tol\", default = 0),   metric = getOption(\"tinysnapshot_metric\", default = \"AE\"),   fuzz = getOption(\"tinysnapshot_fuzz\", default = 0),   diffpath = NULL )"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_equivalent_images.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test if two image files are equivalent — expect_equivalent_images","text":"current path image file target path image file tol distance estimates larger threshold trigger test failure. Scale depends metric argument. default metric=\"AE\" (absolute error), tolerance corresponds roughly number pixels difference plot reference image. metric string metric magick::metric_types() \"AE\" \"phash\". fuzz relative color distance 0 100 considered similar. diffpath path save image shows differences current target. NULL means diff image saved.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_equivalent_images.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test if two image files are equivalent — expect_equivalent_images","text":"tinytest object. tinytest object logical attributes holding information test run","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Test if the new plot matches a target (snapshot) plot — expect_snapshot_plot","title":"Test if the new plot matches a target (snapshot) plot — expect_snapshot_plot","text":"expectation can used tinytest check new plot matches target plot. expectation checked first time, expectation fails reference plot saved inst/tinytest/_tinysnapshot folder. expectation fails, reference plot, new plot, diff saved inst/tinytest/label folder. Call review() function compare. update snapshot, delete reference file _tinysnapshot folder run test suite . See package README file website detailed examples.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test if the new plot matches a target (snapshot) plot — expect_snapshot_plot","text":"","code":"expect_snapshot_plot(   current,   label,   width = getOption(\"tinysnapshot_width\", default = NULL),   height = getOption(\"tinysnapshot_height\", default = NULL),   tol = getOption(\"tinysnapshot_tol\", default = 0),   metric = getOption(\"tinysnapshot_metric\", default = \"AE\"),   fuzz = getOption(\"tinysnapshot_fuzz\", default = 0),   device = getOption(\"tinysnapshot_device\", default = \"svg\"),   os = getOption(\"tinysnapshot_os\", default = Sys.info()[\"sysname\"]) )"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test if the new plot matches a target (snapshot) plot — expect_snapshot_plot","text":"current object class ggplot function returns base R plot. label string identify snapshot (alpha-numeric, hyphens, underscores). plot test suite must unique label. width snapshot. PNG default: 480 pixels. SVG default: 7 inches. height snapshot. PNG default: 480 pixels. SVG default: 7 inches. tol distance estimates larger threshold trigger test failure. Scale depends metric argument. default metric=\"AE\" (absolute error), tolerance corresponds roughly number pixels difference plot reference image. metric string metric magick::metric_types() \"AE\" \"phash\". fuzz relative color distance 0 100 considered similar. device \"svg\", \"png\", \"ragg\" \"svglite\" os character vector operating systems test run (e.g., \"Windows\", \"Linux\", \"Darwin\"). Tests skipped element vector matches output : Sys.info()[\"sysname\"]","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test if the new plot matches a target (snapshot) plot — expect_snapshot_plot","text":"tinytest object. tinytest object logical attributes holding information test run","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_print.html","id":null,"dir":"Reference","previous_headings":"","what":"Test if printed output matches a target printout — expect_snapshot_print","title":"Test if printed output matches a target printout — expect_snapshot_print","text":"expectation can used tinytest check new plot matches target plot. expectation checked first time, expectation fails reference text file saved inst/tinytest/_tinysnapshot folder. update snapshot, delete reference file _tinysnapshot folder run test suite . See package README file website detailed examples.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_print.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test if printed output matches a target printout — expect_snapshot_print","text":"","code":"expect_snapshot_print(   current,   label,   mode = getOption(\"tinysnapshot_mode\", default = \"unified\"),   format = getOption(\"tinysnapshot_format\", default = \"ansi256\"),   ... )"},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_print.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test if printed output matches a target printout — expect_snapshot_print","text":"current object returns text console calling print(x)` label string identify snapshot (alpha-numeric, hyphens, underscores). plot test suite must unique label. mode \"unified\", \"sidebyside\", \"context\", \"auto\". See ?diffobj::diffPrint format \"raw\", \"ansi8\", \"ansi256\", \"html\", \"auto\". See ?diffobj::diffPrint ... Additional arguments passed diffobj::diffPrint()","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/expect_snapshot_print.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test if printed output matches a target printout — expect_snapshot_print","text":"tinytest object. tinytest object logical attributes holding information test run","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/tinyviztest-package.html","id":null,"dir":"Reference","previous_headings":"","what":"Snapshots for Unit Tests using the 'tinytest' Framework — tinysnapshot-package","title":"Snapshots for Unit Tests using the 'tinytest' Framework — tinysnapshot-package","text":"Snapshots unit tests using 'tinytest' framework R. Includes expectations test base R 'ggplot2' plots well console output print().","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/tinyviztest-package.html","id":"package-content","dir":"Reference","previous_headings":"","what":"Package Content","title":"Snapshots for Unit Tests using the 'tinytest' Framework — tinysnapshot-package","text":"Index:  package yet installed build time.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/tinyviztest-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Snapshots for Unit Tests using the 'tinytest' Framework — tinysnapshot-package","text":"NA","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/reference/tinyviztest-package.html","id":"maintainer","dir":"Reference","previous_headings":"","what":"Maintainer","title":"Snapshots for Unit Tests using the 'tinytest' Framework — tinysnapshot-package","text":"Vincent Arel-Bundock <vincent.arel-bundock@umontreal.ca>","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/news/index.html","id":"tinysnapshot-0029000","dir":"Changelog","previous_headings":"","what":"tinysnapshot 0.0.2.9000","title":"tinysnapshot 0.0.2.9000","text":"New os argument skip tests unspecified operating systems.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/news/index.html","id":"tinysnapshot-002","dir":"Changelog","previous_headings":"","what":"tinysnapshot 0.0.2","title":"tinysnapshot 0.0.2","text":"CRAN release: 2023-03-31 write user library CRAN.","code":""},{"path":"https://vincentarelbundock.github.io/tinysnapshot/dev/news/index.html","id":"tinysnapshot-001","dir":"Changelog","previous_headings":"","what":"tinysnapshot 0.0.1","title":"tinysnapshot 0.0.1","text":"CRAN release: 2023-03-28 Initial release","code":""}]
